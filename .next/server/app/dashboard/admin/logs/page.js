(()=>{var e={};e.id=7137,e.ids=[7137],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},26640:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>x,routeModule:()=>h,tree:()=>d});var t=r(73137),a=r(54647),l=r(4183),n=r.n(l),i=r(71775),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);r.d(s,c);let o=t.AppPageRouteModule,d=["",{children:["dashboard",{children:["admin",{children:["logs",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,48256)),"/home/runner/workspace/app/dashboard/admin/logs/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,74436)),"/home/runner/workspace/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,8912)),"/home/runner/workspace/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,51918,23)),"next/dist/client/components/not-found-error"]}],x=["/home/runner/workspace/app/dashboard/admin/logs/page.tsx"],u="/dashboard/admin/logs/page",m={require:r,loadChunk:()=>Promise.resolve()},h=new o({definition:{kind:a.x.APP_PAGE,page:"/dashboard/admin/logs/page",pathname:"/dashboard/admin/logs",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},96072:(e,s,r)=>{Promise.resolve().then(r.bind(r,84960))},84960:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>S});var t=r(60080),a=r(9885),l=r(89176),n=r(6450),i=r(65924),c=r(68384),o=r(49424),d=r(54747),x=r(70589),u=r(24796),m=r(97052),h=r(96253),p=r(43917),j=r(34706),f=r(34253),g=r(20644),v=r(85574),w=r(89815),_=r(69518),N=r(12029),b=r(60667),E=r(87502);function S(){let[e,s]=(0,a.useState)([]),[r,S]=(0,a.useState)(!0),[D,y]=(0,a.useState)(""),[k,R]=(0,a.useState)("all"),[P,C]=(0,a.useState)("all"),[T,A]=(0,a.useState)("today"),{toast:O}=(0,E.pm)();(0,a.useEffect)(()=>{U()},[k,P,T]);let U=async()=>{S(!0);try{let e,r=b.OQ.from("activity_logs").select(`
          *,
          users(full_name)
        `).order("created_at",{ascending:!1}).limit(100);"all"!==k&&(r=r.eq("level",k)),"all"!==P&&(r=r.eq("action",P));let t=new Date;switch(T){case"today":e=new Date(t.getFullYear(),t.getMonth(),t.getDate());break;case"week":e=new Date(t.getTime()-6048e5);break;case"month":e=new Date(t.getFullYear(),t.getMonth(),1);break;default:e=new Date(0)}"all"!==T&&(r=r.gte("created_at",e.toISOString()));let{data:a,error:l}=await r;if(l)throw l;let n=(a||[]).map(e=>({...e,user_name:e.users?.full_name||"Utilisateur inconnu"}));s(n)}catch(r){console.error("Erreur lors du chargement des journaux:",r);let e=[{id:"1",user_id:"1",user_name:"Admin User",action:"LOGIN",description:"Connexion r\xe9ussie \xe0 la plateforme",level:"success",ip_address:"192.168.1.100",user_agent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",created_at:new Date().toISOString()},{id:"2",user_id:"2",user_name:"Marie Dubois",action:"REQUEST_CREATED",description:"Nouvelle demande de convention cr\xe9\xe9e",level:"info",ip_address:"192.168.1.101",user_agent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",created_at:new Date(Date.now()-36e5).toISOString()},{id:"3",user_id:"3",user_name:"Jean Martin",action:"REQUEST_APPROVED",description:"Demande de prolongation approuv\xe9e",level:"success",ip_address:"192.168.1.102",user_agent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36",created_at:new Date(Date.now()-72e5).toISOString()},{id:"4",user_id:"4",user_name:"Sophie Bernard",action:"LOGIN_FAILED",description:"Tentative de connexion \xe9chou\xe9e - mot de passe incorrect",level:"warning",ip_address:"192.168.1.103",user_agent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_7_1 like Mac OS X)",created_at:new Date(Date.now()-108e5).toISOString()},{id:"5",user_id:"5",user_name:"Syst\xe8me",action:"SYSTEM_ERROR",description:"Erreur lors de la g\xe9n\xe9ration du rapport mensuel",level:"error",ip_address:"localhost",user_agent:"System Process",created_at:new Date(Date.now()-144e5).toISOString()}];s(e),O({title:"Information",description:"Affichage des donn\xe9es de d\xe9monstration"})}finally{S(!1)}},q=e.filter(e=>{let s=e.user_name.toLowerCase().includes(D.toLowerCase())||e.action.toLowerCase().includes(D.toLowerCase())||e.description.toLowerCase().includes(D.toLowerCase());return s}),Q=e=>{switch(e){case"success":return t.jsx(h.Z,{className:"h-4 w-4"});case"warning":return t.jsx(p.Z,{className:"h-4 w-4"});case"error":return t.jsx(j.Z,{className:"h-4 w-4"});default:return t.jsx(f.Z,{className:"h-4 w-4"})}},I=e=>{switch(e){case"success":return"default";case"warning":return"secondary";case"error":return"destructive";default:return"outline"}},M=e=>({LOGIN:"Connexion",LOGOUT:"D\xe9connexion",LOGIN_FAILED:"\xc9chec de connexion",REQUEST_CREATED:"Demande cr\xe9\xe9e",REQUEST_APPROVED:"Demande approuv\xe9e",REQUEST_REJECTED:"Demande rejet\xe9e",USER_CREATED:"Utilisateur cr\xe9\xe9",USER_UPDATED:"Utilisateur modifi\xe9",USER_DELETED:"Utilisateur supprim\xe9",SYSTEM_ERROR:"Erreur syst\xe8me",SETTINGS_UPDATED:"Param\xe8tres mis \xe0 jour"})[e]||e,L=(()=>{let s=new Date;s.setHours(0,0,0,0);let r=e.filter(e=>new Date(e.created_at)>=s),t=e.filter(e=>"error"===e.level),a=e.filter(e=>"warning"===e.level);return{total:e.length,today:r.length,errors:t.length,warnings:a.length}})();return r?(0,t.jsxs)("div",{className:"flex min-h-screen flex-col",children:[t.jsx("header",{className:"sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:t.jsx("div",{className:"container flex h-16 items-center",children:t.jsx(l.MainNav,{role:"admin"})})}),(0,t.jsxs)("div",{className:"container flex-1 items-start md:grid md:grid-cols-[220px_1fr] md:gap-6 lg:grid-cols-[240px_1fr] lg:gap-10",children:[t.jsx("aside",{className:"fixed top-14 z-30 -ml-2 hidden h-[calc(100vh-3.5rem)] w-full shrink-0 md:sticky md:block border-r",children:t.jsx(n.T,{role:"admin"})}),t.jsx("main",{className:"flex w-full flex-col overflow-hidden py-6",children:t.jsx("div",{className:"flex items-center justify-center h-96",children:(0,t.jsxs)("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),t.jsx("p",{className:"mt-4 text-muted-foreground",children:"Chargement des journaux..."})]})})})]}),t.jsx(i.n,{})]}):(0,t.jsxs)("div",{className:"flex min-h-screen flex-col",children:[t.jsx("header",{className:"sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:t.jsx("div",{className:"container flex h-16 items-center",children:t.jsx(l.MainNav,{role:"admin"})})}),(0,t.jsxs)("div",{className:"container flex-1 items-start md:grid md:grid-cols-[220px_1fr] md:gap-6 lg:grid-cols-[240px_1fr] lg:gap-10",children:[t.jsx("aside",{className:"fixed top-14 z-30 -ml-2 hidden h-[calc(100vh-3.5rem)] w-full shrink-0 md:sticky md:block border-r",children:t.jsx(n.T,{role:"admin"})}),t.jsx("main",{className:"flex w-full flex-col overflow-hidden py-6",children:(0,t.jsxs)("div",{className:"flex flex-col space-y-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[t.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Journaux d'activit\xe9"}),t.jsx("p",{className:"text-muted-foreground",children:"Consultez l'historique des activit\xe9s de la plateforme."})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(c.z,{onClick:U,variant:"outline",size:"sm",children:[t.jsx(g.Z,{className:"mr-2 h-4 w-4"}),"Actualiser"]}),(0,t.jsxs)(c.z,{onClick:()=>{let e=["Date,Utilisateur,Action,Description,Niveau,IP,User Agent",...q.map(e=>[new Date(e.created_at).toLocaleString("fr-FR"),e.user_name,e.action,`"${e.description}"`,e.level,e.ip_address,`"${e.user_agent}"`].join(","))].join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=`activity_logs_${new Date().toISOString().split("T")[0]}.csv`,r.click()},variant:"outline",size:"sm",children:[t.jsx(v.Z,{className:"mr-2 h-4 w-4"}),"Exporter"]})]})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsxs)(m.Zb,{children:[(0,t.jsxs)(m.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(m.ll,{className:"text-sm font-medium",children:"Total"}),t.jsx(w.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(m.aY,{children:[t.jsx("div",{className:"text-2xl font-bold",children:L.total}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Entr\xe9es au total"})]})]}),(0,t.jsxs)(m.Zb,{children:[(0,t.jsxs)(m.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(m.ll,{className:"text-sm font-medium",children:"Aujourd'hui"}),t.jsx(h.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(m.aY,{children:[t.jsx("div",{className:"text-2xl font-bold",children:L.today}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Activit\xe9s aujourd'hui"})]})]}),(0,t.jsxs)(m.Zb,{children:[(0,t.jsxs)(m.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(m.ll,{className:"text-sm font-medium",children:"Avertissements"}),t.jsx(p.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(m.aY,{children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:L.warnings}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"\xc9v\xe9nements d'attention"})]})]}),(0,t.jsxs)(m.Zb,{children:[(0,t.jsxs)(m.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(m.ll,{className:"text-sm font-medium",children:"Erreurs"}),t.jsx(j.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(m.aY,{children:[t.jsx("div",{className:"text-2xl font-bold text-red-600",children:L.errors}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Erreurs d\xe9tect\xe9es"})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,t.jsxs)("div",{className:"relative w-full md:w-80",children:[t.jsx(_.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),t.jsx(o.I,{placeholder:"Rechercher dans les journaux...",className:"pl-8",value:D,onChange:e=>y(e.target.value)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(x.Ph,{value:T,onValueChange:e=>A(e),children:[t.jsx(x.i4,{className:"w-[150px]",children:t.jsx(x.ki,{placeholder:"P\xe9riode"})}),(0,t.jsxs)(x.Bw,{children:[t.jsx(x.Ql,{value:"today",children:"Aujourd'hui"}),t.jsx(x.Ql,{value:"week",children:"Cette semaine"}),t.jsx(x.Ql,{value:"month",children:"Ce mois"}),t.jsx(x.Ql,{value:"all",children:"Tout"})]})]}),(0,t.jsxs)(x.Ph,{value:k,onValueChange:e=>R(e),children:[(0,t.jsxs)(x.i4,{className:"w-[140px]",children:[t.jsx(N.Z,{className:"mr-2 h-4 w-4"}),t.jsx(x.ki,{placeholder:"Niveau"})]}),(0,t.jsxs)(x.Bw,{children:[t.jsx(x.Ql,{value:"all",children:"Tous niveaux"}),t.jsx(x.Ql,{value:"info",children:"Info"}),t.jsx(x.Ql,{value:"success",children:"Succ\xe8s"}),t.jsx(x.Ql,{value:"warning",children:"Avertissement"}),t.jsx(x.Ql,{value:"error",children:"Erreur"})]})]}),(0,t.jsxs)(x.Ph,{value:P,onValueChange:e=>C(e),children:[(0,t.jsxs)(x.i4,{className:"w-[140px]",children:[t.jsx(N.Z,{className:"mr-2 h-4 w-4"}),t.jsx(x.ki,{placeholder:"Action"})]}),(0,t.jsxs)(x.Bw,{children:[t.jsx(x.Ql,{value:"all",children:"Toutes actions"}),t.jsx(x.Ql,{value:"LOGIN",children:"Connexion"}),t.jsx(x.Ql,{value:"REQUEST_CREATED",children:"Demande cr\xe9\xe9e"}),t.jsx(x.Ql,{value:"REQUEST_APPROVED",children:"Demande approuv\xe9e"}),t.jsx(x.Ql,{value:"USER_CREATED",children:"Utilisateur cr\xe9\xe9"}),t.jsx(x.Ql,{value:"SYSTEM_ERROR",children:"Erreur syst\xe8me"})]})]})]})]}),t.jsx("div",{className:"rounded-md border",children:(0,t.jsxs)(d.iA,{children:[t.jsx(d.xD,{children:(0,t.jsxs)(d.SC,{children:[t.jsx(d.ss,{children:"Date/Heure"}),t.jsx(d.ss,{children:"Utilisateur"}),t.jsx(d.ss,{children:"Action"}),t.jsx(d.ss,{children:"Description"}),t.jsx(d.ss,{children:"Niveau"}),t.jsx(d.ss,{children:"IP"})]})}),t.jsx(d.RM,{children:0===q.length?t.jsx(d.SC,{children:t.jsx(d.pj,{colSpan:6,className:"text-center py-8",children:"Aucun journal trouv\xe9 avec ces crit\xe8res"})}):q.map(e=>(0,t.jsxs)(d.SC,{children:[t.jsx(d.pj,{className:"font-mono text-sm",children:new Date(e.created_at).toLocaleString("fr-FR")}),t.jsx(d.pj,{children:e.user_name}),t.jsx(d.pj,{children:t.jsx(u.C,{variant:"outline",children:M(e.action)})}),t.jsx(d.pj,{className:"max-w-md truncate",children:e.description}),t.jsx(d.pj,{children:(0,t.jsxs)(u.C,{variant:I(e.level),className:"flex items-center gap-1 w-fit",children:[Q(e.level),e.level.toUpperCase()]})}),t.jsx(d.pj,{className:"font-mono text-sm",children:e.ip_address})]},e.id))})]})})]})})]}),t.jsx(i.n,{})]})}},48256:(e,s,r)=>{"use strict";r.r(s),r.d(s,{$$typeof:()=>n,__esModule:()=>l,default:()=>c});var t=r(17536);let a=(0,t.createProxy)(String.raw`/home/runner/workspace/app/dashboard/admin/logs/page.tsx`),{__esModule:l,$$typeof:n}=a,i=a.default,c=i}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[449,2322,6912,6229,251,2662,7471,3623,314,9105,2589,8384,9176,9336,5924,3903,7052,589,8639,4796],()=>r(26640));module.exports=t})();